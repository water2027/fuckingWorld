import{_ as F,r as u,e as q,f as R,g as j,h as P,s as v,c as r,a as s,j as c,t as o,n as J,F as D,b as L,k as g,l as O,m as G,p as T,q as K,i as x,v as Q,o as n}from"./index-Ckvj02d5.js";import{M as S,m as b,p as W,H as X,a as Y,b as Z}from"./MarkdownEditor-D1T_SUNE.js";const ee={class:"postDetail"},te={class:"user"},se=["src"],ae=["innerHTML"],le={key:0,class:"imgs"},ne=["src"],oe={class:"postInfo"},ie={class:"comment"},re={class:"commentButton"},ue={class:"commentList"},ce={class:"user"},me=["src"],de=["innerHTML"],ve={class:"commentButtons"},he=["onClick"],pe=["onClick"],ge={key:1,class:"commentList subCommentList"},fe={class:"user"},ke=["src"],_e=["innerHTML"],we={__name:"PostDetailView",setup(Ce){const d=K(),m=x("userInfo"),B=x("isPC"),C=u(""),l=u({}),f=u([]),h=u({}),p=u({}),k=u({}),_=u(!1),I=u(null),M=q(()=>({width:"100%",height:"auto",margin:"10px 0",fontSize:(B.value,"23px"),paddingLeft:"1%",paddingBottom:"5%",marginBottom:"1%"})),w=(a,e)=>{if(!e)return"";switch(a){case"img":return e.split("|");case"time":return e.replace("T"," ").split("+")[0];default:return e}},y=a=>{if(!a)return;b.setOptions({renderer:new b.Renderer,pedantic:!1,gfm:!0,breaks:!0,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});const e=b(a),t=W.sanitize(e);return setTimeout(()=>{z(),I.value.querySelectorAll("*").forEach($=>{$.style.whiteSpace="pre-wrap"})},0),t},z=()=>{I.value.querySelectorAll("pre code").forEach(e=>{X.highlightElement(e)})},V=async()=>{await Y(C.value,Number(d.params.id),m.value.phone)&&P(Number(d.params.id),m.value.phone).then(e=>{f.value=e,v("评论成功")})},N=async a=>{await Z({content:k.value[a],pcommentID:a,postID:Number(d.params.id),userTelephone:m.value.phone})&&P(Number(d.params.id),m.value.phone).then(t=>{f.value=t,v("评论成功")})},A=async a=>{if(a.target.tagName==="PRE"){const e=a.target.innerText;await navigator.clipboard.writeText(e),v("代码已复制")}},H=a=>{h.value[a]=!h.value[a]},E=a=>{p.value[a]=!p.value[a]},U=async(a,e,t)=>{await Q(a,e,t),l.value.IsLiked=!l.value.IsLiked,l.value.IsLiked?(l.value.Like++,v("点赞成功")):(l.value.Like--,v("取消点赞"))};return R(async()=>{try{const a=await j(Number(d.params.id),m.value.phone),e=await P(Number(d.params.id),m.value.phone);l.value=a,f.value=e,e&&e.forEach(t=>{h.value[t.PcommentID]=!1,p.value[t.PcommentID]=!1,k.value[t.PcommentID]=""})}catch(a){v(`获取帖子失败: ${a}`)}}),(a,e)=>(n(),r("div",{ref_key:"root",ref:I,class:"root",onClick:A},[s("div",ee,[s("div",te,[l.value.UserAvatar?(n(),r("img",{key:0,src:l.value.UserAvatar},null,8,se)):c("",!0),s("span",null,o(l.value.UserName),1)]),s("h2",null,o(l.value.Title),1),s("div",{id:"content",ref:"mdContainer",class:"hasImgDiv",style:J(M.value),innerHTML:y(l.value.Content)},null,12,ae),l.value.Photos?(n(),r("div",le,[(n(!0),r(D,null,L(w("img",l.value.Photos),t=>(n(),r("img",{key:t,src:t},null,8,ne))),128))])):c("",!0),s("span",null,o(w("time",l.value.PostTime)),1),s("div",oe,[s("span",null,[g(o(l.value.Browse)+" ",1),e[3]||(e[3]=s("svg",{viewBox:"0 0 16 16",width:"1em",height:"1em",focusable:"false",role:"img","aria-label":"eye fill",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("g",null,[s("path",{d:"M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"}),s("path",{d:"M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"})])],-1))]),s("span",{class:O(l.value.IsLiked?"like":""),onClick:e[0]||(e[0]=t=>U(l.value.IsLiked,l.value.PostID,G(m).phone))},[g(o(l.value.Like)+" ",1),e[4]||(e[4]=s("svg",{viewBox:"0 0 16 16",width:"1em",height:"1em",focusable:"false",role:"img","aria-label":"heart",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"heart"},[s("g",null,[s("path",{d:"m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"})])],-1))],2),s("span",null,[g(o(l.value.Comment)+" ",1),e[5]||(e[5]=s("svg",{viewBox:"0 0 16 16",width:"1em",height:"1em",focusable:"false",role:"img","aria-label":"chat dots fill",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("g",null,[s("path",{d:"M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234-.2.032-.352-.176-.273-.362.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7zM5 8a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm4 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"})])],-1))])])]),s("div",ie,[e[7]||(e[7]=s("h2",null,"评论",-1)),s("div",re,[s("button",{onClick:e[1]||(e[1]=t=>_.value=!_.value)},o(_.value?"隐藏":"发评论"),1)]),_.value?(n(),T(S,{key:0,modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),onSend:V},null,8,["modelValue"])):c("",!0),s("div",ue,[(n(!0),r(D,null,L(f.value,t=>(n(),r("div",{key:t.PcommentID,class:"commentItem"},[s("div",ce,[t.AuthorAvatar?(n(),r("img",{key:0,src:t.AuthorAvatar},null,8,me)):c("",!0),s("span",null,o(t.Author),1)]),s("div",{class:"hasImgDiv",innerHTML:y(t.Content)},null,8,de),s("span",null,o(w("time",t.CommentTime)),1),s("div",ve,[s("button",{onClick:i=>E(t.PcommentID)},o(p.value[t.PcommentID]?"算了":"评论"),9,he),t.SubComments.length!==0?(n(),r("button",{key:0,onClick:i=>H(t.PcommentID)},o(h.value[t.PcommentID]?"隐藏回复":`显示回复 ${t.SubComments.length}`),9,pe)):c("",!0)]),p.value[t.PcommentID]?(n(),T(S,{key:0,modelValue:k.value[t.PcommentID],"onUpdate:modelValue":i=>k.value[t.PcommentID]=i,onSend:()=>N(t.PcommentID)},null,8,["modelValue","onUpdate:modelValue","onSend"])):c("",!0),h.value[t.PcommentID]?(n(),r("div",ge,[(n(!0),r(D,null,L(t.SubComments,i=>(n(),r("div",{key:i.ccommentID,class:"commentItem"},[s("div",fe,[i.authorAvatar?(n(),r("img",{key:0,src:i.authorAvatar},null,8,ke)):c("",!0),s("span",null,[g(o(i.author)+" ",1),e[6]||(e[6]=s("b",null,"回复",-1)),g(" "+o(i.userTargetName?i.userTargetName:t.Author),1)])]),s("div",{class:"hasImgDiv",innerHTML:y(i.content)},null,8,_e),s("span",null,o(w("time",i.commentTime)),1)]))),128))])):c("",!0)]))),128))])])],512))}},Pe=F(we,[["__scopeId","data-v-8ef2de55"]]);export{Pe as default};
